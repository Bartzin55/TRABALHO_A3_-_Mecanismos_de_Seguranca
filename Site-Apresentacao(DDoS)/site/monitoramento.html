<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ðŸ“ˆ Monitoramento | CiberDefesa</title>
  <link rel="stylesheet" href="style.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    /* ajustes locais leves para o painel de monitoramento (full-width) */
    .monitor-grid { display:block; gap:18px; align-items:start; }
    .monitor-panel { padding:20px; border-radius:12px; background: rgba(0,0,0,0.35); border:1px solid rgba(220,38,38,0.14); }
    .metric-row{display:flex;gap:12px;align-items:center}
    .metric-label{width:140px;color:var(--cor-texto-secundario);font-weight:600}
    .bar-wrap{flex:1;background:rgba(0,0,0,0.35);border-radius:10px;padding:8px;border:1px solid rgba(255,255,255,0.02)}
    .bar-fill{height:20px;border-radius:8px;background:linear-gradient(90deg,var(--cor-principal),var(--cor-accent));width:0%}
    .small-muted{font-size:0.95em;color:var(--cor-texto-secundario)}
    .stat-big{font-family:'Orbitron',monospace;color:var(--cor-principal);font-size:1.1em}
    .status-top {display:flex;gap:12px;align-items:center;justify-content:space-between;margin-bottom:10px;flex-wrap:wrap}
    .status-pill{padding:8px 12px;border-radius:999px;border:1px solid rgba(255,255,255,0.03);font-weight:600;background:rgba(0,0,0,0.25)}
    /* make chart area bigger on wide screens */
    #miniChart{ width:100% !important; height:360px !important; display:block }
    @media (max-width:900px){
      #miniChart{ height:260px !important }
      .metric-label{width:120px}
    }
  </style>
</head>
<body>

  <header>
    <div class="nav-container">
      <div class="logo"><a href="index.html">ðŸ”’ CiberDefesa</a></div>
      <nav>
        <a href="index.html">Home</a>
        <a href="fundamentos.html">Fundamentos</a>
        <a href="mecanismos.html">Mecanismos</a>
        <a href="ddos.html">Ataques DDoS</a>
        <a href="monitoramento.html" class="active">Monitoramento</a>
      </nav>
    </div>
  </header>

  <div class="container">
    <section>
      <h2>Monitoramento em Tempo Real</h2>
      <p>Visualize CPU, memÃ³ria, conexÃµes TCP e trÃ¡fego. Ideal para demonstrar impacto do DDoS e o efeito das medidas de mitigaÃ§Ã£o.</p>

      <div class="monitor-grid" style="margin-top:16px">
        <!-- painel principal (full width) -->
        <div class="monitor-panel" style="width:96%">
          <div class="status-top">
            <div style="min-width:220px">
              <div class="small-muted">Status da coleta</div>
              <div id="statusText" class="status-pill">Conectandoâ€¦</div>
            </div>
            <div style="display:flex;gap:18px;align-items:center">
              <div style="text-align:right">
                <div class="small-muted">Ãšltima</div>
                <div id="lastTime" class="stat-big">â€”:â€”:â€”</div>
              </div>
            </div>
          </div>

          <div style="margin-top:12px">
            <div class="metric-row" style="margin-bottom:12px">
              <div class="metric-label">CPU</div>
              <div class="bar-wrap"><div id="cpuFill" class="bar-fill"></div></div>
              <div style="width:64px;text-align:right" id="cpuValue" class="small-muted">â€”%</div>
            </div>

            <div class="metric-row" style="margin-bottom:12px">
              <div class="metric-label">MemÃ³ria</div>
              <div class="bar-wrap"><div id="memFill" class="bar-fill" style="background:linear-gradient(90deg,var(--cor-sucesso),#22c55e)"></div></div>
              <div style="width:64px;text-align:right" id="memValue" class="small-muted">â€”%</div>
            </div>

            <div class="metric-row" style="margin-bottom:12px">
              <div class="metric-label">Rede</div>
              <div class="bar-wrap">
                <div id="netFill2" class="bar-fill" style="background:linear-gradient(90deg,#3b82f6,#60a5fa)"></div>
              </div>
              <div style="width:64px;text-align:right" id="netValue2" class="small-muted">â€”%</div>
            </div>

            <div class="metric-row" style="margin-bottom:12px">
              <div class="metric-label">ConexÃµes</div>
              <div style="flex:1"><div id="connValue" class="small-muted">â€”</div></div>
              <div style="width:64px;text-align:right" id="connLabel" class="small-muted">EST</div>
            </div>

            <div class="metric-row" style="margin-bottom:12px">
              <div class="metric-label">TrÃ¡fego</div>
              <div style="flex:1"><div id="netValue" class="small-muted">â€” B/s</div></div>
              <div style="width:64px;text-align:right" class="small-muted">avg</div>
            </div>
          </div>

          <hr style="border:none;height:1px;background:linear-gradient(90deg,transparent,var(--cor-principal),transparent);margin:18px 0">

          <div>
            <canvas id="miniChart"></canvas>
            <div class="small-muted" style="margin-top:10px">Ãšltimos 60 segundos â€” atualizaÃ§Ã£o: 1s</div>
          </div>
        </div>
      </div>

    </section>
  </div>

<script>
/* logic: fetch /status every 1s, update bars and chart */
const URL = '/status';
const MAX = 60;
let labels = Array(MAX).fill('');
let dataCpu = Array(MAX).fill(null);
let dataMem = Array(MAX).fill(null);
let dataConn = Array(MAX).fill(null);
let dataNet = Array(MAX).fill(null);

const ctx = document.getElementById('miniChart').getContext('2d');
const miniChart = new Chart(ctx, {
  type: 'line',
  data: {
    labels: labels.slice(),
    datasets: [
      { label: 'CPU %', data: dataCpu.slice(), borderColor: 'rgba(220,38,38,0.95)', tension:0.25, borderWidth:2, pointRadius:0, fill:false },
      { label: 'Mem %', data: dataMem.slice(), borderColor: 'rgba(16,185,129,0.95)', tension:0.25, borderWidth:2, pointRadius:0, fill:false },
      { label: 'ConexÃµes', data: dataConn.slice(), borderColor: 'rgba(248,113,113,0.85)', tension:0.25, borderWidth:2, pointRadius:0, fill:false },
      { label: 'Rede %', data: dataNet.slice(), borderColor: 'rgba(59,130,246,0.95)', tension: 0.25, borderWidth: 2, pointRadius: 0, fill: false }
    ]
  },
  options: {
    animation:false,
    responsive:true,
    maintainAspectRatio:false,
    plugins:{legend:{labels:{boxWidth:12}}},
    scales:{
      x:{ display:false },
      y:{ beginAtZero:true }
    }
  }
});

function pushValue(arr, v){ arr.push(v); if(arr.length>MAX) arr.shift(); }

async function updateOnce(){
  try{
    const res = await fetch(URL, {cache:'no-store'});
    if(!res.ok) throw new Error('status '+res.status);
    const m = await res.json();

    // update UI
    const cpu = (m.cpu_percent !== undefined) ? m.cpu_percent : 0;
    const mem = (m.memory_percent !== undefined) ? m.memory_percent : 0;
    const conn = (m.tcp_established >= 0) ? m.tcp_established : null;
    const net = (m.bytes_sent_per_s !== undefined && m.bytes_recv_per_s !== undefined) ? ((m.bytes_sent_per_s + m.bytes_recv_per_s)/2) : null;
    const usage = (m.network_usage_percent !== undefined) ? m.network_usage_percent : 0;
    const netPercent = (m.network_usage_percent !== undefined) ? m.network_usage_percent : 0;

    document.getElementById('netFill2').style.width = Math.min(100, usage) + '%';
    document.getElementById('netValue2').textContent = usage.toFixed(1) + '%';
    document.getElementById('cpuFill').style.width = Math.min(100,cpu)+'%';
    document.getElementById('cpuValue').textContent = cpu.toFixed(1)+'%';
    document.getElementById('memFill').style.width = Math.min(100,mem)+'%';
    document.getElementById('memValue').textContent = mem.toFixed(1)+'%';
    document.getElementById('connValue').textContent = conn !== null ? conn : 'N/A';
    document.getElementById('netValue').textContent = net !== null ? Math.round(net)+' B/s' : 'N/A';
    document.getElementById('statusText').textContent = 'OK';
    document.getElementById('lastTime').textContent = new Date(m.timestamp*1000).toLocaleTimeString();

    // push chart arrays
    pushValue(dataCpu, cpu);
    pushValue(dataMem, mem);
    pushValue(dataConn, conn);
    pushValue(dataNet, netPercent);

    miniChart.data.labels = Array.from({length:dataCpu.length}, (_,i)=>'');
    miniChart.data.datasets[0].data = dataCpu.slice();
    miniChart.data.datasets[1].data = dataMem.slice();
    miniChart.data.datasets[2].data = dataConn.slice();
    miniChart.data.datasets[3].data = dataNet.slice();
    miniChart.update('none');

  } catch(err){
    console.error('fetch error', err);
    document.getElementById('statusText').textContent = 'ERRO / SOBRECARGA';
    document.getElementById('lastTime').textContent = new Date().toLocaleTimeString();
    // push nulls so chart keeps moving
    pushValue(dataCpu, null); pushValue(dataMem, null); pushValue(dataConn, null);
    miniChart.update('none');
  }
}

updateOnce();
setInterval(updateOnce, 1000);
</script>

</body>
</html>


